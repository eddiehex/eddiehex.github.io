<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shark Blog</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/prism-code.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="icon" href="https://od.009100.xyz/api/raw/?path=/picture/Icon/shark.png" type="image/x-icon">
  <link rel="stylesheet" href="/css/toc.css">
  
  <!-- MathJax Configuration -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        packages: ['base', 'ams', 'noerrors', 'noundefined']
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      },
      startup: {
        ready() {
          MathJax.startup.defaultReady();
          // Re-render math when content changes
          document.addEventListener('DOMContentLoaded', function() {
            if (window.MathJax && window.MathJax.typesetPromise) {
              window.MathJax.typesetPromise();
            }
          });
        }
      }
    };
  </script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
  <header>
    <nav>
      <div class="nav-container">
        <div class="logo"><a href="/">Shark Blog</a></div>
        <div class="search-container">
          <input type="text" id="search-input" placeholder="Search...">
          <div id="search-results"></div>
        </div>
        <div class="menu-toggle">
          <i class="fas fa-bars"></i>
        </div>
      </div>
      <ul class="nav-links">
        <li><a href="/">Posts</a></li>
        <li><a href="/services">Services</a></li>
        <li><a href="/archives">Archive</a></li>
        <li><a href="/categories">Categories</a></li>
        <li><a href="/about">About</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="page-container">
  
    <div class="toc-card">
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1"><span class="toc-text">1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2"><span class="toc-text">2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3"><span class="toc-text">3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4"><span class="toc-text">4</span></a></li></ol>
      </div>
    </div>
  
  
  <article class="page-content">
    <h1 class="page-title">python学习记录</h1>
    <div class="page-body">
      <h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><ol>
<li>数据创建和读取</li>
<li>数据查看和选择</li>
<li>数据清洗和处理</li>
<li>数据统计和聚合</li>
<li>数据合并和重塑</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 1. 创建数据</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'姓名'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token string">'王五'</span><span class="token punctuation">,</span> <span class="token string">'赵六'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'年龄'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'城市'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'北京'</span><span class="token punctuation">,</span> <span class="token string">'上海'</span><span class="token punctuation">,</span> <span class="token string">'广州'</span><span class="token punctuation">,</span> <span class="token string">'深圳'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'工资'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token number">15000</span><span class="token punctuation">,</span> <span class="token number">25000</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># 2. 基础查看方法</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 查看前几行</span>
df<span class="token punctuation">.</span>shape        <span class="token comment"># 查看维度</span>
df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># 查看基本信息</span>
df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 统计描述</span>

<span class="token comment"># 3. 数据选择</span>
df<span class="token punctuation">[</span><span class="token string">'姓名'</span><span class="token punctuation">]</span>                  <span class="token comment"># 选择单列</span>
df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'姓名'</span><span class="token punctuation">,</span> <span class="token string">'年龄'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token comment"># 选择多列</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                  <span class="token comment"># 按标签选择行</span>
df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>              <span class="token comment"># 按位置选择行</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'年龄'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">]</span>     <span class="token comment"># 条件筛选</span>

<span class="token comment"># 4. 数据处理</span>
df<span class="token punctuation">[</span><span class="token string">'工资'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment"># 填充空值</span>
df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># 删除重复行</span>
df<span class="token punctuation">[</span><span class="token string">'工资等级'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'工资'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">'高'</span> <span class="token keyword">if</span> x <span class="token operator">></span> <span class="token number">20000</span> <span class="token keyword">else</span> <span class="token string">'低'</span><span class="token punctuation">)</span>  <span class="token comment"># 添加新列</span>

<span class="token comment"># 5. 统计聚合</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'城市'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'工资'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 分组计算平均值</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">'工资'</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># 排序</span>
df<span class="token punctuation">[</span><span class="token string">'工资'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment"># 计数统计</span>

<span class="token comment"># 6. 数据合并</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'城市'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'北京'</span><span class="token punctuation">,</span> <span class="token string">'上海'</span><span class="token punctuation">,</span> <span class="token string">'广州'</span><span class="token punctuation">,</span> <span class="token string">'深圳'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'人口'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2100</span><span class="token punctuation">,</span> <span class="token number">2400</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">1700</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df<span class="token punctuation">,</span> df2<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">'城市'</span><span class="token punctuation">)</span>        <span class="token comment"># 合并数据框</span>

<span class="token comment"># 7. 数据重塑</span>
df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>                    <span class="token comment"># 透视表</span>
    values<span class="token operator">=</span><span class="token string">'工资'</span><span class="token punctuation">,</span>
    index<span class="token operator">=</span><span class="token string">'城市'</span><span class="token punctuation">,</span>
    aggfunc<span class="token operator">=</span><span class="token string">'mean'</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><ol>
<li>创建含缺失值的示例数据</li>
<li>展示isnull&#x2F;isna检测方法</li>
<li>展示dropna删除方法</li>
<li>展示drop删除行列方法</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 创建带有缺失值的数据框</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'姓名'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'李四'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token string">'赵六'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'年龄'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'城市'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'北京'</span><span class="token punctuation">,</span> <span class="token string">'上海'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">'深圳'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'工资'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">25000</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># 1. isnull()/isna() - 检测缺失值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"检查缺失值:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 返回布尔矩阵</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n缺失值统计:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 每列缺失值计数</span>

<span class="token comment"># 2. dropna() - 删除缺失值</span>
<span class="token comment"># 删除任何含有缺失值的行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n删除所有含缺失值的行:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 删除全部为缺失值的行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n删除全部为缺失值的行:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>how<span class="token operator">=</span><span class="token string">'all'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 仅当特定列有缺失值时删除</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n仅当年龄列缺失时删除:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'年龄'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 3. drop() - 删除指定行或列</span>
<span class="token comment"># 删除指定列</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n删除'工资'列:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'工资'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 删除指定行（基于索引）</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n删除第0行:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 删除多个列</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n删除多个列:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'工资'</span><span class="token punctuation">,</span> <span class="token string">'城市'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>检测缺失值:</strong></p>
<ul>
<li><code>isnull()</code>&#x2F;<code>isna()</code>: 检测每个元素是否为缺失值</li>
<li><code>isnull().sum()</code>: 统计每列缺失值数量</li>
</ul>
<p><strong>dropna()参数:</strong></p>
<ul>
<li><code>axis=0/1</code>: 0删除行，1删除列</li>
<li><code>how=&#39;any&#39;/&#39;all&#39;</code>: any-任何缺失值都删除，all-全部缺失才删除</li>
<li><code>subset=[列名]</code>: 仅检查指定列的缺失值</li>
<li><code>thresh=n</code>: 至少有n个非空值才保留</li>
</ul>
<p><strong>drop()参数:</strong></p>
<ul>
<li><code>labels</code>: 要删除的行标签或列名</li>
<li><code>axis=0/1</code>: 0删除行，1删除列</li>
<li><code>index</code>: 要删除的行索引</li>
<li><code>columns</code>: 要删除的列名</li>
<li><code>inplace=True/False</code>: 是否修改原数据</li>
</ul>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><ol>
<li>数据转换方法</li>
<li>索引操作</li>
<li>时间序列处理</li>
<li>字符串处理</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 创建示例数据</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'日期'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2024-01-01'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'产品'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'A产品'</span><span class="token punctuation">,</span> <span class="token string">'B产品'</span><span class="token punctuation">,</span> <span class="token string">'A产品'</span><span class="token punctuation">,</span> <span class="token string">'B产品'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'数量'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'价格'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10.5</span><span class="token punctuation">,</span> <span class="token number">20.5</span><span class="token punctuation">,</span> <span class="token number">15.5</span><span class="token punctuation">,</span> <span class="token number">25.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'描述'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'好评-优秀'</span><span class="token punctuation">,</span> <span class="token string">'好评-良好'</span><span class="token punctuation">,</span> <span class="token string">'差评-一般'</span><span class="token punctuation">,</span> <span class="token string">'好评-优秀'</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># 1. 数据转换</span>
<span class="token comment"># astype() - 类型转换</span>
df<span class="token punctuation">[</span><span class="token string">'数量'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'数量'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float64'</span><span class="token punctuation">)</span>

<span class="token comment"># reset_index() - 重置索引</span>
df_reset <span class="token operator">=</span> df<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># set_index() - 设置索引</span>
df_indexed <span class="token operator">=</span> df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'日期'</span><span class="token punctuation">)</span>

<span class="token comment"># 2. 字符串操作 (str)</span>
<span class="token comment"># 分割字符串</span>
df<span class="token punctuation">[</span><span class="token string">'评价类型'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'描述'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
df<span class="token punctuation">[</span><span class="token string">'评价等级'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'描述'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># 包含判断</span>
mask <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'描述'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'好评'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"好评数据：\n"</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 3. 时间序列操作 (dt)</span>
<span class="token comment"># 提取日期组件</span>
df<span class="token punctuation">[</span><span class="token string">'年份'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'日期'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>year
df<span class="token punctuation">[</span><span class="token string">'月份'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'日期'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>month
df<span class="token punctuation">[</span><span class="token string">'星期'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'日期'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>day_name<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 4. 数据计算</span>
<span class="token comment"># 算术运算</span>
df<span class="token punctuation">[</span><span class="token string">'总价'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'数量'</span><span class="token punctuation">]</span> <span class="token operator">*</span> df<span class="token punctuation">[</span><span class="token string">'价格'</span><span class="token punctuation">]</span>

<span class="token comment"># 累计统计</span>
df<span class="token punctuation">[</span><span class="token string">'累计数量'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'数量'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 5. 数据替换</span>
<span class="token comment"># replace() - 值替换</span>
df<span class="token punctuation">[</span><span class="token string">'产品'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'产品'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A产品'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B产品'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># 6. 数据排序</span>
<span class="token comment"># sort_values() - 多列排序</span>
df_sorted <span class="token operator">=</span> df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'产品'</span><span class="token punctuation">,</span> <span class="token string">'数量'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 7. 数据采样</span>
<span class="token comment"># sample() - 随机采样</span>
df_sample <span class="token operator">=</span> df<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>n<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 随机抽取2行</span>

<span class="token comment"># 8. 数据统计</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n基本统计："</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'数量'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'mean'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'价格'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'mean'</span><span class="token punctuation">,</span> <span class="token string">'std'</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>数据转换：</strong></p>
<ul>
<li><code>astype()</code>: 类型转换</li>
<li><code>reset_index()</code>: 重置索引</li>
<li><code>set_index()</code>: 设置索引</li>
</ul>
<p><strong>字符串操作：</strong></p>
<ul>
<li><code>str.split()</code>: 分割字符串</li>
<li><code>str.contains()</code>: 包含判断</li>
<li><code>str.replace()</code>: 替换字符串</li>
</ul>
<p><strong>时间序列：</strong></p>
<ul>
<li><code>dt.year/month/day</code>: 提取日期组件</li>
<li><code>dt.day_name()</code>: 获取星期名称</li>
</ul>
<p><strong>数据计算：</strong></p>
<ul>
<li>直接算术运算</li>
<li><code>cumsum()/cumprod()</code>: 累计统计</li>
<li><code>agg()</code>: 聚合统计</li>
</ul>
<p><strong>其他操作：</strong></p>
<ul>
<li><code>replace()</code>: 值替换</li>
<li><code>sort_values()</code>: 排序</li>
<li><code>sample()</code>: 随机采样</li>
</ul>
<h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><ol>
<li>高级分组操作</li>
<li>窗口函数</li>
<li>数据重塑操作</li>
<li>多索引处理</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 创建示例数据</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'部门'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'技术'</span><span class="token punctuation">,</span> <span class="token string">'技术'</span><span class="token punctuation">,</span> <span class="token string">'销售'</span><span class="token punctuation">,</span> <span class="token string">'销售'</span><span class="token punctuation">,</span> <span class="token string">'技术'</span><span class="token punctuation">,</span> <span class="token string">'销售'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'日期'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2024-01-01'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'姓名'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token string">'王五'</span><span class="token punctuation">,</span> <span class="token string">'赵六'</span><span class="token punctuation">,</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'王五'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'销售额'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">3500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'成本'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># 1. 高级分组操作</span>
<span class="token comment"># transform - 广播计算结果</span>
df<span class="token punctuation">[</span><span class="token string">'部门平均销售额'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'部门'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'销售额'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token string">'mean'</span><span class="token punctuation">)</span>

<span class="token comment"># agg - 多重聚合</span>
result <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'部门'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'销售额'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'mean'</span><span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'成本'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'mean'</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># 2. 窗口函数</span>
<span class="token comment"># rolling - 滚动窗口</span>
df<span class="token punctuation">[</span><span class="token string">'销售额_3日均值'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'销售额'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># expanding - 扩展窗口</span>
df<span class="token punctuation">[</span><span class="token string">'销售额_累计均值'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'销售额'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>expanding<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 3. 数据重塑</span>
<span class="token comment"># pivot - 数据透视</span>
pivot_table <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>
    values<span class="token operator">=</span><span class="token string">'销售额'</span><span class="token punctuation">,</span>
    index<span class="token operator">=</span><span class="token string">'部门'</span><span class="token punctuation">,</span>
    columns<span class="token operator">=</span><span class="token string">'姓名'</span><span class="token punctuation">,</span>
    aggfunc<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">,</span>
    fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>

<span class="token comment"># melt - 宽转长</span>
melted_df <span class="token operator">=</span> pivot_table<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>melt<span class="token punctuation">(</span>
    id_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'部门'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    var_name<span class="token operator">=</span><span class="token string">'姓名'</span><span class="token punctuation">,</span>
    value_name<span class="token operator">=</span><span class="token string">'销售额'</span>
<span class="token punctuation">)</span>

<span class="token comment"># 4. 多索引操作</span>
<span class="token comment"># 创建多索引DataFrame</span>
multi_idx <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'技术'</span><span class="token punctuation">,</span> <span class="token string">'销售'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'一季度'</span><span class="token punctuation">,</span> <span class="token string">'二季度'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'部门'</span><span class="token punctuation">,</span> <span class="token string">'季度'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

df_multi <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    index<span class="token operator">=</span>multi_idx<span class="token punctuation">,</span>
    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'收入'</span><span class="token punctuation">,</span> <span class="token string">'支出'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token comment"># 多索引选择</span>
tech_data <span class="token operator">=</span> df_multi<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'技术'</span><span class="token punctuation">]</span>
q1_data <span class="token operator">=</span> df_multi<span class="token punctuation">.</span>xs<span class="token punctuation">(</span><span class="token string">'一季度'</span><span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token string">'季度'</span><span class="token punctuation">)</span>

<span class="token comment"># 5. 高级计算</span>
<span class="token comment"># pct_change - 计算环比变化</span>
df<span class="token punctuation">[</span><span class="token string">'销售额环比'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'销售额'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># diff - 计算差值</span>
df<span class="token punctuation">[</span><span class="token string">'销售额增量'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'销售额'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># shift - 数据移位</span>
df<span class="token punctuation">[</span><span class="token string">'上期销售额'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'销售额'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级分组：</strong></p>
<ul>
<li><code>transform()</code>: 广播聚合结果</li>
<li><code>agg()</code>: 多重聚合运算</li>
</ul>
<p><strong>窗口函数：</strong></p>
<ul>
<li><code>rolling()</code>: 滑动窗口计算</li>
<li><code>expanding()</code>: 扩展窗口计算</li>
</ul>
<p><strong>数据重塑：</strong></p>
<ul>
<li><code>pivot_table()</code>: 数据透视表</li>
<li><code>melt()</code>: 宽格式转长格式</li>
</ul>
<p><strong>多索引操作：</strong></p>
<ul>
<li><code>MultiIndex</code>: 创建多级索引</li>
<li><code>xs()</code>: 跨层级选择数据</li>
</ul>
<p><strong>高级计算：</strong></p>
<ul>
<li><code>pct_change()</code>: 计算变化百分比</li>
<li><code>diff()</code>: 计算差值</li>
<li><code>shift()</code>: 数据移位</li>
</ul>

    </div>
  </article>
</div>
  </main>

  <footer>
    <p>
      &copy; 2025 Shark Blog 
      <a href="https://github.com/eddiehex/hexo-geek-source" target="_blank">
        <i class="fab fa-github"></i>
      </a>
    </p>
  </footer>

  <script src="/js/search.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/copy-code.js"></script>
  <script src="/js/prism.js"></script>
  <script src="/js/toc-highlight.js"></script>
  <script src="/js/mobile-menu.js"></script>
</body>
</html>